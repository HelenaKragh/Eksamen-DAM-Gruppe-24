---
title: "RMarkDown_Eksamen"
author: "Gruppe24"
date: "2024-05-23"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#dir.create("data")
#install.packages("tidyverse")
#install.packages("here")
#install.packages("dplyr")
#install.packages("tidyr")
#install.packages("ggplot2")
#install.packages("reader")
library(tidyverse)
library(here)
library("dplyr")
library(tidyr)
library("ggplot2")
library("reader")
library(leaflet)
library(readxl)

aarhus_census <- read.csv(here("data_fælles","dataset_clean.csv"))
```


```{r}
aarhus_data <- aarhus_census %>%
mutate(Erhvervskategori = case_when(
erhverv %in% c("Geheime Raadjnde af Woyda", "Arbeyder i litteratur", "provst", "geheimeråd og stiftamtmand", "Baron, kammerherre og amtmand", "Præste enke", "Baronesse", "Bestyrer", "Grevinde og har 400 Rdr i Enke Pension", "Biskop", "Rådmand", "Betjent", "Billeteur", "Branddirektør", "Hendes Mand har fast Tjeneste", "Skolelærer", "Hospitalsforstander", "Cancellirådinde, - lever af det, hun har", "Candedatus Theologies", "Cappelan", "Consumptionsbetjent", "Contoirbetjent", "Degn", "Dommer", "Informator", "Inspecteur", "Enke Degn", "Enke Provstinde", "Etatsraadinde", "Jurist", "Sognepræst", "Kammerherre", "Kammerråd", "Foged", "Kornmåler", "Formuende", "Forpagter", "Landmaaler", "Lever af Formue", "Lever af sin Formue", "Forvalter", "Fuldmægtig", "stiftsphysicus", "stiftsrevisor", "Student", "Lægdsmand", "Læge", "Ved Landvæsenet", "Marqueur", "Told", "toldkasserer", "Organist") ~ "Embedsmænd, funktionære og liberale erhverv",
erhverv%in% c("Apoteker", "Postmester, Kiøb- og Værtshusmusmand, Gæstgiver og prokurator", "Handler", "Brændevinsmand", "Købmand", "Værtshusmand") ~ "Købmænd",
erhverv %in% c("Gartner", "Baber", "Bager", "Bagerenke", "Glarmester", "Rebslager", "Skoflikker", "Skomager", "Skrædder", "Håndværksmager", "Slagter", "Smed", "Snedker", "Kok", "Mester", "Teglbrænder") ~ "Håndværksmestre",
erhverv %in% c("Apotekerdreng", "Assistent", "Garver", "Skoleelev", "Giør Stoele", "Gjørtler", "Blegmand", "Blikkenslager", "Bogbinder", "Byens tambour", "Bødker", "Hugger", "I Lære", "Drejer", "Farver", "Favn Brænde Kiøer", "Mahler og Gartner", "Tømrer", "Svend") ~ "Svend eller i Lære",
erhverv %in% c( "Gadekører", "Hjulmand", "klubvært", "Kromand", "Kudsk", "Forridder", "Vognmand", "Opvarterske for de syge") ~ "Avlsmænd, vognmænd og værtsholdere",
erhverv %in% c("Skipper", "Fiskemester ved grevskabet Frijsenborg", "Fisker", "Lods", "Matros") ~ "Skippere, jægere, fiskere",
erhverv %in% c("Graver", "Arbejder ved Canalen", "Går med bagerkurven", "Spinder", "Rådstuebud", "Baademand", "Skovridder", "Hyrde", "Høker", "Skærsliber", "Jordemoder", "Examineret Foster Moder", "Kalkslager", "Klokker", "Stadsmusikant", "Krambodsdreng", "Stenkløver og -hugger, beboer et Markhuus, er Landeværnsmand", "Lever af at stampe Vadmel", "Fostermoder", "Stenpikker", "Lever af sit Arbejde", "Faar Løn", "strømpevæver", "Væver", "Vægter", "Volunteur", "Læser for Børn i Byen", "strøekone ved Domkirken", "Vaskekone", "Substitut", "Syerske", "Mejerske", "Tærsker", "Træskomand", "Natmand", "Trykker", "Tobaksspinder", "Nærer sig ved Haandarbejde") ~ "Ufaglært arbejder",
erhverv %in% c("General Krigs Commisair, Rigs-Greve", "Skytte", "Rytter", "Soldat", "fhv. militærmand med årlig pension", "Overordnet Soldat") ~ "Militært personel",
erhverv %in% c("Afskediget", "Antagen til opdragelse", "Besvangret", "Enke", "Fattig", "formedels sin solgte gaard", "Ledig", "Lever af sine midler", "Opdrages i huset") ~ "Uden erhverv",
erhverv %in% c("Rygter paa Gersdorrslund", "Huusholderske", "Stuekone", "Tyende", "Tjener Familie") ~ "Tyende",
erhverv %in% c("Aftægtsfolk", "Pension", "Frit underholdt", "Logerende", "Understøtter Familiemedlem", "Understøttelse af Private", "Understøttelse af Familie", "nyder Ophold", "nyder Ophold af gaarden") ~ "Aftægtsfolk/pensionerede",
erhverv %in% c("Proprietair", "Har en Mølle i Fæste", "Boelsmand", "Bonde og Gaardbeboer", "Huusmand", "Huusmand med Jord", "Huusmand og andet Erhverv", "Enke med Jord", "Stamherre", "Møller") ~ "Bonde med jord",
erhverv %in% c("Daglejer", "Inderste", "Jordløs Huusmand") ~ "Bonde uden jord",
erhverv %in% c("Hospitalslem", "Vanvittig") ~ "Syge og vanføre",
erhverv %in% c("Tigger") ~ "Tiggere",
erhverv %in% c("Nyder Almisse") ~ "Almissemodtager",

famstand%in% c("Tyende") ~ "Tyende",
grepl("opholds", famstand) ~ "Aftægtsfolk/pensionerede",
grepl("Opholds", famstand) ~ "Aftægtsfolk/pensionerede",


TRUE ~ "Ukendt"

))
```


<<<<<<< HEAD
```{r}
for (i in 2:nrow(aarhus_data)) {
  if(aarhus_data$famstand[i] =="Hans Kone"){
  aarhus_data$Erhvervskategori[i]<- 
    paste(aarhus_data$Erhvervskategori[i-1], "kone")
  }
  }
```

#grafer over fordeling af køn på erhverv

```{r}
procent_køn_erhverv <- aarhus_data %>%
  filter(koen != "") %>% 
  count(koen, Erhvervskategori) %>% 
  group_by(Erhvervskategori) %>% 
  mutate(koen_procent = (n/sum(n))*100)
   
procent_køn_erhverv %>% 
  ggplot(aes(x = Erhvervskategori, y = koen_procent, fill = koen)) +
  geom_bar(stat = "identity") + 
  theme(axis.text.x = element_text(angle = -45, hjust = 0)) +
  scale_fill_manual(values = c("dodgerblue", "orange")) + 
  labs(title = "Procentfordeling af køn i erhvervskategorier",
       fill = "Køn",
       x = "Erhvervskategori",
       y = "Procent")
```


#Civilstand fordeling på erhverv

```{r}
procent_civilstand_erhverv <- aarhus_data %>% 
  filter(civilstand != "") %>% 
  count(civilstand, Erhvervskategori) %>% 
  group_by(Erhvervskategori) %>% 
  mutate(civilstand_procent = (n/sum(n))*100)

procent_civilstand_erhverv %>% 
  ggplot(aes(x = Erhvervskategori, y = civilstand_procent, fill = civilstand)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = -45, hjust = 0)) +
  scale_fill_manual(values = c("tomato", "orange", "green3", "yellow", "purple", "dodgerblue")) +
  labs(title = "Procentfordeling af civilstand i erhvervskategorier",
       fill = "Køn",
       x = "Erhvervskategori",
       y = "Procent")  

```

Vi vil gerne kigge på alderen, cvilstanden og den geografiske for de forskellige erhverv af fattige:
Tyende, Syge og vanføre, Bønder uden jord, Tiggere, Almissemodtagere, Aftægtsfolk/pensionerede, Arbejdsløse, Ufaglærte arbejdere og Svend eller i lære

Vi starter med at lave et nyt dataset, hvor vi isolerer erhvervskategorien "Tyende" fra aarhus_data
```{r}
Tyende_data <- filter(aarhus_data,Erhvervskategori=="Tyende")
```
Nu laver vi to søjlediagrammer for de tyende fra datasættet. Den første viser fordelingen i tyendes alder samt deres civilstand
```{r}
#Alder og civilstand
ggplot(Tyende_data,aes(alder))+
  geom_bar(aes(fill = civilstand))+
  theme(axis.text = element_text(angle = -90))
#Geografisk placering
ggplot(Tyende_data,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))
```
Vi gør det samme med "Syge og vanføre"
```{r}
Sygeogvanføre_data <- filter(aarhus_data,Erhvervskategori=="Syge og vanføre")
#Alder og civilstand
ggplot(Sygeogvanføre_data,aes(alder))+
  geom_bar(aes(fill = civilstand))+
  theme(axis.text = element_text(angle = -90))
#Geografisk placering
ggplot(Sygeogvanføre_data,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))
```
Bønder uden jord
```{r}
Bonde_u_jord <- filter(aarhus_data,Erhvervskategori=="Bonde uden jord")
#Alder og civilstand
ggplot(Bonde_u_jord,aes(alder))+
  geom_bar(aes(fill = civilstand))+
theme(axis.text = element_text(angle = -90))
#Geografisk placering
ggplot(Bonde_u_jord,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))

```
Tiggere
```{r}
Tigger_data <- filter(aarhus_data,Erhvervskategori=="Tiggere")
#Alder og civilstand
ggplot(Tigger_data,aes(alder))+
  geom_bar(aes(fill = civilstand))
#Geografisk placering
ggplot(Tigger_data,aes(sogn))+
  geom_bar()
```
Almissemodtagere her laver vi også et diagram med alder og køn
```{r}
Almissemodtager_data <- filter(aarhus_data,Erhvervskategori=="Almissemodtager")
#Alder og civilstand
ggplot(Almissemodtager_data,aes(alder))+
  geom_bar(aes(fill = civilstand))+
  theme(axis.text = element_text(angle = -90))

#Alder og Køn
ggplot(Almissemodtager_data,aes(alder))+
  geom_bar(aes(fill = koen))+
  theme(axis.text = element_text(angle = -90))

#Geografisk placering
ggplot(Almissemodtager_data,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))
```
Aftægtsfolk/pensionerede vi laver også et med alder og køn
```{r}
Aftægt_data <- filter(aarhus_data,Erhvervskategori=="Aftægtsfolk/pensionerede")
#Alder og civilstand
ggplot(Aftægt_data,aes(alder))+
  geom_bar(aes(fill = civilstand))+
  theme(axis.text = element_text(angle = -90))
#Alder og køn
ggplot(Aftægt_data,aes(alder))+
  geom_bar(aes(fill = koen))+
  theme(axis.text = element_text(angle = -90))
#Geografisk placering
ggplot(Aftægt_data,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))

```
Arbejdsløse
```{r}
Uden_erhverv_data <- filter(aarhus_data,Erhvervskategori=="Uden erhverv")
#Alder og civilstand
ggplot(Uden_erhverv_data,aes(alder))+
  geom_bar(aes(fill = civilstand))
#Alder og køn
ggplot(Uden_erhverv_data,aes(alder))+
  geom_bar(aes(fill = koen))+
  theme(axis.text = element_text(angle = -90))
#Geografisk placering
ggplot(Uden_erhverv_data,aes(sogn))+
  geom_bar()+
theme(axis.text = element_text(angle = -90))

```
Ufaglærte arbejdere og et med alder og køn
```{r}
Ufaglært_arbejder_data <- filter(aarhus_data,Erhvervskategori=="Ufaglært arbejder")
#Alder og civilstand
ggplot(Ufaglært_arbejder_data,aes(alder))+
  geom_bar(aes(fill=civilstand))+
  theme(axis.text = element_text(angle = -90))
#Alder og køn
ggplot(Ufaglært_arbejder_data,aes(alder))+
  geom_bar(aes(fill = koen))+
  theme(axis.text = element_text(angle = -90))
#Geografisk placering
ggplot(Ufaglært_arbejder_data,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))
```
Svend eller i lære
```{r}
Svend_lære_data <- filter(aarhus_data,Erhvervskategori=="Svend eller i Lære")
#Alder og civilstand
ggplot(Svend_lære_data,aes(alder))+
  geom_bar(aes(fill = civilstand))
#Geografisk placering
ggplot(Svend_lære_data,aes(sogn))+
  geom_bar()+
  theme(axis.text = element_text(angle = -90))
```


#Klargøring til at lave kort


```{r}
Koordinater <- readxl::read_excel (here("data_fælles",""),                                      col_types = c("text", "numeric", "numeric"))

View(Koordinater)



Aarhus_data_K <- aarhus_data
Aarhus_data_K <-  left_join(aarhus_data, Koordinater, by = "sogn")
```

#kortet bliver lavet


<<<<<<< HEAD
##################### LEAFLET #######################

For at visualisere hvor de fattige levede, har vi valgt at lave et kort over de sogne der indgår i aarhus_census datasettet. 

1) Første step er at indlæse library "leaflet", som er R-studios kortfunktion, og library(readxl), for at kunne indlæse excelfilen

2) Dernæst indlæses dataen indeholdende koordinaterne til hvert sogn. 



3) Vi vil af med videnskabelig notation, da koordinaterne skal være numerisk noteret, og da de i processen ved indlæsningen blev "usunde" i vores dataframe. 

```{r}
options(scipen = 999)
```

5) Nu plotter vi vores leafletkort med markers, der fortæller navnet på sognet og informationer fra en ny kolonne i dataframet kaldet "content": 

```{r}
Koordinater <- Koordinater %>% 
  mutate(content_popup= paste0("<h1>", sogn, "</h1> TEKST")) 
  
```

6) Nu plotter vi kortet:

```{r}
Koordinater %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers(~longitude,~latitude,
             popup = ~content_popup)
```

#Eksempel på skabelse af graf m erhvervsfodeling i sognet
```{r}


#graf sogn og erhverv

procent_alrø_erhverv <- aarhus_data %>% 
  filter(sogn == "Alrø") %>% 
  count(sogn, Erhvervskategori) %>% 
  group_by(Erhvervskategori)
  
procent_alrø_erhverv <- procent_alrø_erhverv %>%   
  mutate(alrø_procent = (n/sum(procent_alrø_erhverv$n))*100, round(alrø_procent, digits = 2))

#gem grafen som png
alroe_erhverv_graf <- procent_alrø_erhverv %>% 
  ggplot(aes(x = Erhvervskategori, y = alrø_procent)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(alrø_procent, digits = 2), vjust = -0.4)) + 
  theme(axis.text.x = element_text(angle = -45, hjust = 0)) +
  labs(title = "Procentfordeling af erhverv i Alrø Sogn",
       x = "Erhvervskategori",
       y = "Procent") 

ggsave(alroe_erhverv_graf, filename = "graphics/sogn_graphics/alroe.png", device = png, width = 20, height = 15, units = "cm" )
```


# ret problematiske navne i koordinater-tibble
```{r}
Koordinater[112,1] <- "Århus Købstad"

Koordinater[72,1] <-  "Skanderborg Købstad"
```

# forlooping over 113 parishes
#tilføjelse af sogn-navne med små forbogstaver og uden danske bogstaver 

```{r}

parish_filename_relation <- tibble(sogn = character(), fil = character())

 

for (parish in Koordinater$sogn) {

  print(parish)

  procent_erhverv_sogn <- aarhus_data %>%

  filter(sogn == parish) %>%

  count(sogn, Erhvervskategori) %>%

  group_by(Erhvervskategori)

 

  procent_erhverv_sogn <- procent_erhverv_sogn %>%  

  mutate(sogn_procent = (n/sum(procent_erhverv_sogn$n))*100, round(sogn_procent, digits = 2))

 

  sogn_erhverv_graf <- procent_erhverv_sogn %>%

  ggplot(aes(x = Erhvervskategori, y = sogn_procent)) +

  geom_bar(stat = "identity") +

  geom_text(aes(label = round(sogn_procent, digits = 2), vjust = -0.4)) +

  theme(axis.text.x = element_text(angle = -45, hjust = 0)) +

  labs(title = paste0("Procentfordeling af erhverv i ", parish, " sogn"),

       x = "Erhvervskategori",

       y = "Procent")

  

  filename_parish <- str_replace(parish, regex("Å", ignore_case = TRUE), "aa") %>%

    str_replace(regex("Ø", ignore_case = TRUE), "oe") %>%

    str_replace(regex("Æ", ignore_case = TRUE), "ae") %>%

    str_replace(regex(" ", ignore_case = TRUE), "_") %>%

    str_to_lower()

   

print(filename_parish) 

 

parish_filename_relation <- parish_filename_relation %>%

  add_row(sogn = parish, fil = filename_parish)

 

  ggsave(sogn_erhverv_graf, filename = paste0("graphics/sogn_graphics/", filename_parish, ".png"), device = png, width = 20, height = 15, units = "cm" )

}

 

```

#tilføj de rigtige grafer til de rigtige sogn/koordinater

```{r}

Koordinater <- Koordinater %>%

  left_join(parish_filename_relation, by = "sogn")

```


 
#popup med png-filer
#link til GitHub Repositori med png-filer 
 

```{r}

Koordinater <- Koordinater %>%

  mutate(img_link = paste0("https://github.com/HelenaKragh/Eksamen-DAM-Gruppe-24/blob/main/eksamens%20projekt/graphics/sogn_graphics/", fil, ".png?raw=true"))

```


tilføjelse af "billede" af graf til popup
 

```{r}

Koordinater <- Koordinater %>%

  mutate(content_popup= paste0("<h1>", sogn, "</h1> Her TEKST", '<br>', '<a href="', img_link, '">', '<img src="', img_link,'" width="200">', '</a> <br>'))

```
